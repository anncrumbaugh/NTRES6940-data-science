<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lesson 9: ggplot part 2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Collaborative and Reproducible Data Science in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture notes</li>
    <li>
      <a href="lesson1-rstudio.html">Lesson 1: R Studio</a>
    </li>
    <li>
      <a href="lesson2-rmarkdown-github.html">Lesson 2: RMarkdown and GitHub</a>
    </li>
    <li>
      <a href="lesson3-version-control.html">Lesson 3: Version Control</a>
    </li>
    <li>
      <a href="lesson4-collaboration.html">Lesson 4: Collaborating with GitHub</a>
    </li>
    <li>
      <a href="lesson5-collaboration-part2.html">Lesson 5: Collaborating and Making Websites</a>
    </li>
    <li>
      <a href="lesson6-ggplot-part1.html">Lesson 6: Plotting with ggplot, part 1</a>
    </li>
    <li>
      <a href="lesson7-data-wrangling1.html">Lesson 7: Data wrangling, part 1</a>
    </li>
    <li>
      <a href="lesson8-data-wrangling2.html">Lesson 8: Data wrangling, part 2</a>
    </li>
    <li>
      <a href="lesson9-ggplot-part2.html">Lesson 9: Plotting with ggplot, part 2</a>
    </li>
    <li>
      <a href="lesson10-tidy-data.html">Lesson 10: Tidy data</a>
    </li>
    <li>
      <a href="lesson11-debugging-getting-help.html">Lesson 11: Good coding practices and debugging</a>
    </li>
    <li>
      <a href="lesson12-relational-data.html">Lesson 12: Relational data</a>
    </li>
    <li>
      <a href="lesson13-data-import-and-types.html">Lesson 13: Data import and types</a>
    </li>
    <li>
      <a href="lesson14-for-loops.html">Lesson 14: Iteration (for loops) and conditional execution</a>
    </li>
    <li>
      <a href="lesson15-functions.html">Lesson 15: Functions</a>
    </li>
    <li>
      <a href="lesson16-factors.html">Lesson 16: Factors</a>
    </li>
  </ul>
</li>
<li>
  <a href="assignments.html">Assignments</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Lesson 9: ggplot part 2</h1>

</div>


<p><br> <br></p>
<div id="readings" class="section level2">
<h2>Readings</h2>
<p><strong>Required</strong>:</p>
<ul>
<li><p>Review Chapter 3.1-3.6 and read Chapter 3.7-3.10 in <a href="https://r4ds.had.co.nz/data-visualisation.html#statistical-transformations">Grolemund and Wickham’s R for Data Science</a></p></li>
<li><p>Skim the <a href="https://style.tidyverse.org/">The tidyverse style guide</a> for inspiration - <strong>you don’t have to read the whole guide carefully</strong></p></li>
</ul>
<p><br></p>
<p><strong>Additional resources</strong>:</p>
<ul>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">RStudio’s ggplot2 cheat sheet</a></p></li>
<li><p><a href="http://varianceexplained.org/r/why-I-use-ggplot2/">“Why I use ggplot2” - David Robinson Blog Post</a></p></li>
</ul>
<p><br></p>
</div>
<div id="announcements" class="section level2">
<h2>Announcements</h2>
<ul>
<li>Assignment 3 is due tonight at 10pm</li>
<li>Assignment 4 will be posted tonight (due Oct 19)</li>
<li>No class on Wednesday</li>
<li>We’re half-way through the course! We will send around a mid-term evaluation survey later this week and would really appreciate your feedback. All responses will be completely anonymous</li>
</ul>
<p><br></p>
</div>
<div id="todays-learning-objectives" class="section level2">
<h2>Today’s learning objectives</h2>
<p>The goal for today’s class is to return to <code>ggplot</code> to get more practice with using this package for data visualization, cover a few additional aspects of its functionality, and integrate the <code>dplyr</code> data wrangling skills we learned last week to further customize our plots.</p>
<p>By the end of this class, you should be able to:</p>
<ul>
<li>Use different geometric objects and aesthetics to explore various plot types in <code>ggplot</code></li>
<li>Chain together steps for data wrangling (<code>dplyr</code>) and plotting <code>ggplot</code></li>
</ul>
<p>If we have time, we will wrap up with a brief discussion of good coding practices.</p>
<p><br></p>
<p><strong>Acknowledgements</strong>: Today’s lecture borrows from several excellent resources including the <a href="https://rstudio-conf-2020.github.io/r-for-excel/">R for Excel users</a> course by Julia Stewart Lowndes and Allison Horst and Chapter 3 of <a href="https://r4ds.had.co.nz/data-visualisation.html#statistical-transformations">Grolemund and Wickham’s R for Data Science</a>.</p>
<p><br> <br></p>
</div>
<div id="recap-on-the-grammar-of-graphics-implemented-in-ggplot" class="section level2">
<h2>Recap on the Grammar of Graphics implemented in <code>ggplot</code></h2>
<p>This overview is borrowed from the <a href="https://stat545guidebook.netlify.com/intro-to-plotting-with-ggplot2-part-i.html">STAT545 course at UBC</a></p>
<p><img src="https://cxlabsblog.files.wordpress.com/2017/10/2017-10-24-14_36_29-visualization-layers-of-ggplot-google-docs.png" /></p>
<p>You can think of the grammar of graphics as a systematic approach for describing the components of a graph. It has seven components (the ones in <strong>bold</strong> are required to be specifed explicitly in ggplot2):</p>
<ul>
<li><strong>Data</strong>
<ul>
<li>Exactly as it sounds: the data that you’re feeding into a plot.</li>
</ul></li>
<li><strong>Aesthetic mappings</strong>
<ul>
<li>This is a specification of how you will connect variables (columns) from your data to a visual dimension. These visual dimensions are called “aesthetics”, and can be (for example) horizontal positioning, vertical positioning, size, colour, shape, etc.</li>
</ul></li>
<li><strong>Geometric objects</strong>
<ul>
<li>This is a specification of what object will actually be drawn on the plot. This could be a point, a line, a bar, etc.</li>
</ul></li>
<li>Scales
<ul>
<li>This is a specification of how a variable is mapped to its aesthetic. Will it be mapped linearly? On a log scale? Something else?</li>
</ul></li>
<li>Statistical transformations
<ul>
<li>This is a specification of whether and how the data are combined/transformed before being plotted. For example, in a bar chart, data are transformed into their frequencies; in a box-plot, data are transformed to a five-number summary.</li>
</ul></li>
<li>Coordinate system
<ul>
<li>This is a specification of how the position aesthetics (x and y) are depicted on the plot. For example, rectangular/cartesian, or polar coordinates.</li>
</ul></li>
<li>Facet
<ul>
<li>This is a specification of data variables that partition the data into smaller “sub plots”, or panels.</li>
</ul></li>
</ul>
<p>These components are like parameters of statistical graphics, defining the “space” of statistical graphics. In theory, there is a one-to-one mapping between a plot and its grammar components, making this a useful way to specify graphics.</p>
<p><br></p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>We’ll return to exploring the Coronavirus dataset. I’ll try to focus on typical beginner’s errors along the way so we can get used to trouble-shooting together.</p>
<p>Before we start, please open the R Project associated with your class GitHub repository. Then create a new RMarkdown file, select github_document output format, and save it to your lecture note folder. Copy today’s <a href="https://github.com/nt246/NTRES6940-data-science/blob/master/in_class_exercises/lesson9_in-class-worksheet.Rmd">template for in-class exercises</a> into your RMarkdown document and save it. You can follow along in this worksheet as we go through the lecture.</p>
<p><br></p>
<p>First, let’s load our packages and read in our Coronavirus dataset</p>
<pre class="r"><code>suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))

coronavirus &lt;- read_csv(&#39;https://raw.githubusercontent.com/RamiKrispin/coronavirus/master/csv/coronavirus.csv&#39;, col_types = cols(province = col_character()))


# Has it been updated? Check the latest date?
max(coronavirus$date)</code></pre>
<pre><code>## [1] &quot;2020-11-09&quot;</code></pre>
<p><br> <br></p>
</div>
<div id="combining-dplyr-and-ggplot" class="section level2">
<h2>Combining <code>dplyr</code> and <code>ggplot</code></h2>
<p>Let’s start with summarizing the total number of cases by type as of the most recent day in the dataset: 2020-11-09. Take a minute to try this for yourself, then you can look at our approach.</p>
<p><br></p>
<details>
<summary>
click to see our approach
</summary>
<pre class="r"><code>total_cases &lt;- coronavirus %&gt;% 
  group_by(type) %&gt;%
  summarize(cases = sum(cases))

kable(total_cases)  # kable() just provides a nice output for the table</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="right">cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">confirmed</td>
<td align="right">50913976</td>
</tr>
<tr class="even">
<td align="left">death</td>
<td align="right">1263094</td>
</tr>
<tr class="odd">
<td align="left">recovered</td>
<td align="right">33289404</td>
</tr>
</tbody>
</table>
</details>
<p><br></p>
<p>Now, let’s plot the history of the daily counts of new confirmed cases worldwide</p>
<pre class="r"><code># We first have to summarize the data, then plot those summary statistics
# Note that we can pipe dplyr output directly into ggplot
coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-3-1.png" /><!-- --></p>
<p><br></p>
<p>If we want to play around with different geoms, we can store <code>dplyr</code> data processing steps and initiation of the <code>ggplot</code> as object <code>gg_base</code> so that we don’t need to retype it each time</p>
<pre class="r"><code>gg_base &lt;- coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = total_cases)) </code></pre>
<p>Then when we want to draw the plot, we can just call that object and specify the geom</p>
<pre class="r"><code>gg_base +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-5-1.png" /><!-- --></p>
<p><br> <br></p>
<p>Try these</p>
<pre class="r"><code>gg_base +
  geom_point()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-1.png" /><!-- --></p>
<pre class="r"><code>gg_base +
  geom_col(color=&quot;red&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-2.png" /><!-- --></p>
<pre class="r"><code>gg_base +
  geom_area()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-3.png" /><!-- --> <br> <br></p>
</div>
<div id="customizing-plots" class="section level2">
<h2>Customizing plots</h2>
<p>First, a quick reminder on how we can customize some aesthetics (e.g. colors, styles, axis labels, etc.) of our graphs based on non-variable values.</p>
<blockquote>
<p>We can change the aesthetics of elements in a ggplot graph by adding arguments within the layer where that element is created. Some common arguments we’ll use first are:</p>
</blockquote>
<ul>
<li><code>color =</code>: update point or line colors</li>
<li><code>fill =</code>: update fill color for objects with areas</li>
<li><code>linetype =</code>: update the line type (dashed, long dash, etc.)</li>
<li><code>pch =</code>: update the point style</li>
<li><code>size =</code>: update the element size (e.g. of points or line thickness)</li>
<li><code>alpha =</code>: update element opacity (1 = opaque, 0 = transparent)</li>
</ul>
<p>Building on our first line graph, let’s update the line color to “purple” and make the line type “dashed”:</p>
<pre class="r"><code>gg_base +
  geom_line(
    color = &quot;purple&quot;,
    linetype = &quot;dashed&quot;
  )</code></pre>
<p><img src="lesson9-files/unnamed-chunk-7-1.png" /><!-- --></p>
<p>How do we know which color names ggplot will recognize? If you google “R colors ggplot2” you’ll find a lot of good resources. Here’s one: <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">SAPE ggplot2 colors quick reference guide</a></p>
<p>Now let’s update the point, style and size of points on our previous scatterplot graph using <code>color =</code>, <code>size =</code>, and <code>pch =</code> (see <code>?pch</code> for the different point styles, which can be further customized).</p>
<pre class="r"><code>gg_base + 
  geom_point(color = &quot;purple&quot;,
             pch = 17,
             size = 4,
             alpha = 0.5)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-8-1.png" /><!-- --></p>
<p><br> <br></p>
</div>
<div id="mapping-variables-onto-aesthetics" class="section level2">
<h2>Mapping variables onto aesthetics</h2>
<p>In the examples above, we have customized aesthetics based on constants that we input as arguments (e.g., the color / style / size isn’t changing based on a variable characteristic or value). Often, however, we <strong>do</strong> want the aesthetics of a graph to depend on a variable. To do that (as we’ve discussed earlier), we’ll <strong>map variables onto graph aesthetics</strong>, meaning we’ll change how an element on the graph looks based on a variable characteristic (usually, character or value).</p>
<blockquote>
<p>When we want to customize a graph element based on a variable’s characteristic or value, add the argument within <code>aes()</code> in the appropriate <code>geom_*()</code> layer. In short, if updating aesthetics based on a variable, make sure to put that argument inside of <code>aes()</code>.</p>
</blockquote>
<p><strong>Example:</strong> Create a ggplot scatterplot graph where the <strong>size</strong> and <strong>color</strong> of the points change based on the <strong>number of cases</strong>, and make all points the same level of opacity (<code>alpha = 0.5</code>). Notice the <code>aes()</code> around the <code>size =</code> and <code>color =</code> arguments.</p>
<p>Note: this is just for illustration of the functionality only - we are showing the same information in redundant ways, which is typically not helpful or necessary. Avoid excessive / overcomplicated aesthetic mapping in data visualization.</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5
  )</code></pre>
<p><img src="lesson9-files/unnamed-chunk-9-1.png" /><!-- --></p>
<p>In the example above, notice that the two arguments that <strong>do</strong> depend on variables are within <code>aes()</code>, but since <code>alpha = 0.5</code> doesn’t depend on a variable then it is <em>outside the <code>aes()</code> but still within the <code>geom_point()</code> layer</em>.</p>
<p>When we map variables to aesthetics, <code>ggplot2</code> will automatically assign a unique level of the aesthetic (here a unique color) to each unique value of the variable, a process known as scaling. <code>ggplot2</code> will also add a legend that explains which levels correspond to which values.</p>
<p><br> <br></p>
</div>
<div id="ggplot2-complete-themes" class="section level2">
<h2>ggplot2 complete themes</h2>
<p>While every element of a ggplot graph is manually customizable, there are also built-in themes (<code>theme_*()</code>) that you can add to your ggplot code to make some major headway before making smaller tweaks manually.</p>
<p>We talked about this briefly a few classes ago, but let’s explore a little further. Here are a few to try today (but also notice all the options that appear as we start typing <code>theme_</code> into our ggplot graph code!):</p>
<ul>
<li><code>theme_light()</code></li>
<li><code>theme_minimal()</code></li>
<li><code>theme_bw()</code></li>
</ul>
<p>Also, check out more examples by scrolling down <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html#examples">here</a>. Pick one that you like and update your previous plot.</p>
<p>Here, let’s update our previous graph with <code>theme_minimal()</code>:</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5
  ) +
  theme_minimal()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-10-1.png" /><!-- --> <br></p>
<p>You can play around with other themes - see an overview and instructions for how to customize themes <a href="https://ggplot2-book.org/polishing.html">here</a></p>
<p><br> <br></p>
</div>
<div id="updating-axis-labels-and-titles" class="section level2">
<h2>Updating axis labels and titles</h2>
<p>Use <code>labs()</code> to update axis labels, and add a title and/or subtitle to your ggplot graph.</p>
<pre class="r"><code>gg_base +
  geom_line(linetype = &quot;dotted&quot;) +
  theme_bw() +
  labs(
    x = &quot;Date&quot;,
    y = &quot;Total confirmed cases&quot;,
    title = &quot;Daily counts of new Coronavirus cases recorded&quot;,
    subtitle = &quot;Global sums&quot;
  )</code></pre>
<p><img src="lesson9-files/unnamed-chunk-11-1.png" /><!-- --></p>
<p><strong>Note</strong>: If you want to update the formatting of axis values (for example, to convert to comma format instead of scientific format above), you can use the <code>scales</code> package options and add <code>+ scale_y_continuous(labels = scales::comma)</code> (see more from the <a href="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/">R Cookbook</a>).</p>
<p><br> <br></p>
</div>
<div id="now-lets-split-the-case-counts-out-by-country" class="section level2">
<h2>Now, let’s split the case counts out by country</h2>
<p><br></p>
<div id="your-turn" class="section level3">
<h3>Your turn</h3>
<blockquote>
<p>Take a minute to think about how you would generate a plot with a separate line showing the daily reports of new confirmed cases in each country.</p>
</blockquote>
<p><br></p>
<p>Here is some code we might try. Why does that not work?</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot() +
  geom_line(mapping = aes(x = date, y = total_cases, color = country))
# We have summarized out the country details (only one total count per day)</code></pre>
<p><br></p>
<p>We’ll have to group by both country and date. But why does this not work?</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(country, date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line()
# Even though we have grouped the dataframe by country, that dplyr grouping does not get carried into ggplot</code></pre>
<p><br></p>
<p>Now let’s make ggplot group the data too by mapping country onto an aesthetic</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(country, date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = total_cases, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-14-1.png" /><!-- --></p>
<p>It looks like this is doing what we want, but it does not display well. There are too many countries! We could play around with the layout parameters to be able to see this plot. But let’s instead subset to only show the 10 countries with the highest total counts of confirmed cases.</p>
<pre class="r"><code>top10_countries &lt;- coronavirus %&gt;% 
  filter(type == &quot;confirmed&quot;) %&gt;%
  group_by(country) %&gt;%
  summarize(total_cases = sum(cases)) %&gt;%
  arrange(-total_cases) %&gt;% 
  head(10) %&gt;% 
  .$country</code></pre>
<p><br></p>
<p>Now let’s try to plot the daily counts of new cases just for those countries</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;, country %in% top10_countries) %&gt;% 
  group_by(country, date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;%  # Need this summarize because some countries have data broken down by Province.State
  ggplot(mapping = aes(x = date, y = total_cases, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-16-1.png" /><!-- --> Much better!</p>
<p><br></p>
<p>We can also make a separate panel for each country</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;, country %in% top10_countries) %&gt;% 
  group_by(country, date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line() +
  facet_wrap(~country)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-17-1.png" /><!-- --></p>
<p><br></p>
<p>Now let’s plot the cumulative sum of cases for each of those countries instead</p>
<pre class="r"><code>coronavirus %&gt;%  
  filter(type == &quot;confirmed&quot;, country %in% top10_countries) %&gt;%
  group_by(country) %&gt;% 
  arrange(date) %&gt;% 
  mutate(cum_count = cumsum(cases)) %&gt;% 
  ggplot(mapping = aes(x = date, y = cum_count, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-18-1.png" /><!-- --></p>
<p><br> <br></p>
</div>
</div>
<div id="bar-charts" class="section level2">
<h2>Bar charts</h2>
<p>Another common plot type are bar charts. There are two types of bar charts in <code>ggplot</code>: <code>geom_bar()</code> and <code>geom_col()</code>. <code>geom_bar()</code> makes the height of the bar proportional to the number of cases in each group (or if the weight aesthetic is supplied, the sum of the weights). If you want the heights of the bars to represent values in the data, use <code>geom_col()</code> instead.</p>
<p>Since our dataset reports counts of cases, let’s first start with <code>geom_col()</code> (we have already used it once today).</p>
<pre class="r"><code>coronavirus %&gt;% 
  group_by(date) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases), color = &quot;black&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-19-1.png" /><!-- --></p>
<p>If we want a stacked barplot separating out the different types of cases, we can use the fill aesthetic</p>
<pre class="r"><code>coronavirus %&gt;% 
  group_by(date, type) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases, fill = type), size=0.1)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-20-1.png" /><!-- --> If it looks like your chart is just made up of black bars, try making it bigger, or reduce the <code>size</code> argument (which controls the line thickness).</p>
<p><br></p>
<p>We may want to flip this around</p>
<pre class="r"><code>coronavirus %&gt;% 
  group_by(date, type) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases, fill = type), size=0.1) +
  coord_flip()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-21-1.png" /><!-- --></p>
<p>This is useful because it puts the proportions in relation to the total daily counts. But it can be hard to compare proportions. We can make all bars the same height with ‘position adjustment’</p>
<pre class="r"><code>coronavirus %&gt;% 
  group_by(date, type) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x=date, y = cases, fill = type), color=&quot;black&quot;, size=0.1, position = &quot;fill&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-22-1.png" /><!-- --></p>
<p><br></p>
<p>Let’s check if we have negative cases.</p>
<pre class="r"><code>coronavirus %&gt;% 
  filter(cases &lt; 0)</code></pre>
<pre><code>## # A tibble: 379 x 7
##    date       province country               lat   long type      cases
##    &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 2020-07-03 &lt;NA&gt;     Antigua and Barbuda 17.1  -61.8  confirmed    -1
##  2 2020-05-19 &lt;NA&gt;     Benin                9.31   2.32 confirmed  -209
##  3 2020-08-27 &lt;NA&gt;     Cyprus              35.1   33.4  confirmed   -17
##  4 2020-05-07 &lt;NA&gt;     Ecuador             -1.83 -78.2  confirmed -1583
##  5 2020-05-08 &lt;NA&gt;     Ecuador             -1.83 -78.2  confirmed -1480
##  6 2020-05-11 &lt;NA&gt;     Ecuador             -1.83 -78.2  confirmed   -50
##  7 2020-09-07 &lt;NA&gt;     Ecuador             -1.83 -78.2  confirmed -7953
##  8 2020-07-15 &lt;NA&gt;     Finland             61.9   25.7  confirmed    -5
##  9 2020-07-16 &lt;NA&gt;     Finland             61.9   25.7  confirmed    -3
## 10 2020-04-18 &lt;NA&gt;     France              46.2    2.21 confirmed   -17
## # … with 369 more rows</code></pre>
<pre class="r"><code># Let&#39;s remove those
coronavirus %&gt;% 
  filter(cases &gt; 0) %&gt;% 
  group_by(date, type) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases, fill = type), size=0.1, position = &quot;fill&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-23-1.png" /><!-- --></p>
<p><br></p>
<p>We can also get the bars for the different types of cases each day stacked next to each other with another position adjustment option</p>
<pre class="r"><code>coronavirus %&gt;% 
  filter(cases &gt; 0) %&gt;% 
  group_by(date, type) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases, fill = type), position = &quot;dodge&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-24-1.png" /><!-- --></p>
<p><br></p>
<p>Now, let’s break it down by country. Let’s again subset to only the top 10 countries with the highest counts</p>
<pre class="r"><code>coronavirus %&gt;% 
  filter(cases &gt; 0, country %in% top10_countries) %&gt;%
  group_by(country, type, date) %&gt;%
  summarize(cases = sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x = date, y = cases, fill = type), position = &quot;fill&quot;, width = 1) +
  facet_wrap(~country)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-25-1.png" /><!-- --></p>
<p><br></p>
<p>While looking at the proportions of case types in different areas is helpful for comparing patterns, they don’t allow for comparison of the magnitude of case counts. Let’s again scale the bars by the raw case counts.</p>
<pre class="r"><code>coronavirus %&gt;% 
  filter(cases &gt; 0, country %in% top10_countries) %&gt;%
  group_by(country, type, date) %&gt;%
  summarize(cases=sum(cases)) %&gt;%
  ggplot() +
  geom_col(aes(x=date, y = cases, fill = type), position = &quot;identity&quot;, width = 1) +
  facet_wrap(~country)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-26-1.png" /><!-- --></p>
<p><br> <br></p>
<p>Now, let’s explore a different question. For each day, let’s plot how many different countries have at least one new confirmed case. For this we will need to count rows within grouped variables, so we’ll use the geom_bar()</p>
<pre class="r"><code>#How many countries have at least one confirmed case each day
coronavirus %&gt;%
  filter(type == &quot;confirmed&quot;) %&gt;% 
  group_by(country, date) %&gt;% 
  summarize(total_cases = sum(cases)) %&gt;% 
  filter(total_cases &gt; 0) %&gt;% 
  ggplot() +
  geom_bar(mapping = aes(x = date), color=&quot;black&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-27-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="plotting-with-labels" class="section level2">
<h2>Plotting with labels</h2>
<p>Now let’s look at the relationship between confirmed cases and deaths in each country. For this we will need our re-formatted wide data from last class.</p>
<pre class="r"><code>coronavirus_ttd &lt;- coronavirus %&gt;% 
  select(country, type, cases) %&gt;%
  group_by(country, type) %&gt;%
  summarize(total_cases = sum(cases)) %&gt;%
  pivot_wider(names_from = type,
              values_from = total_cases) %&gt;%
  arrange(-confirmed)

ggplot(coronavirus_ttd) +
  geom_point(mapping = aes(x = confirmed, y = death))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-28-1.png" /><!-- --></p>
<p>That’s nice, but it would be useful to know which country is represented by each dot. <code>geom_label</code> is our tool for that.</p>
<pre class="r"><code>ggplot(coronavirus_ttd) +
  geom_label(mapping = aes(x = confirmed, y = death, label = country))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-29-1.png" /><!-- --> <br></p>
<p>Let’s do a few things to make this easier to read</p>
<p>We can remove countries with a small number of confirmed cases</p>
<pre class="r"><code>ggplot(data = filter(coronavirus_ttd, confirmed &gt; 500000)) +
  geom_label(mapping = aes(x = confirmed, y = death, label = country))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-30-1.png" /><!-- --></p>
<p>We can remove the area with low confirmed case count from the plot</p>
<pre class="r"><code>ggplot(data = filter(coronavirus_ttd, confirmed &gt; 500000)) +
  geom_label(mapping = aes(x = confirmed, y = death, label = country)) +
  xlim(1000000, max(coronavirus_ttd$confirmed))</code></pre>
<pre><code>## Warning: Removed 10 rows containing missing values (geom_label).</code></pre>
<p><img src="lesson9-files/unnamed-chunk-31-1.png" /><!-- --></p>
<p>Or zoom in on that region</p>
<pre class="r"><code>ggplot(data = filter(coronavirus_ttd)) +
  geom_label(mapping = aes(x = confirmed, y = death, label = country)) +
  xlim(0, 30000)</code></pre>
<pre><code>## Warning: Removed 88 rows containing missing values (geom_label).</code></pre>
<p><img src="lesson9-files/unnamed-chunk-32-1.png" /><!-- --></p>
<p><br> <br></p>
<div id="bonus-spatial-plotting" class="section level3">
<h3>Bonus: Spatial plotting</h3>
<div id="map-of-newly-reported-cases" class="section level4">
<h4>Map of newly reported cases</h4>
<p>With some additional packages, we can also plot geographical patterns on a map. We can, for example, show which countries have new counts of &gt;5000 new confirmed cases on the most recent day from this dataset and scale the points with case counts.</p>
<pre class="r"><code>library(&quot;rnaturalearth&quot;) # install.packages(&quot;rnaturalearth&quot;)
library(&quot;rnaturalearthdata&quot;) # install.packages(&quot;rnaturalearthdata&quot;)
library(&quot;rgeos&quot;) #install.packages(&quot;rgeos&quot;)</code></pre>
<pre><code>## Warning: package &#39;rgeos&#39; was built under R version 3.6.2</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Warning: package &#39;sp&#39; was built under R version 3.6.2</code></pre>
<pre><code>## rgeos version: 0.5-3, (SVN revision 634)
##  GEOS runtime version: 3.7.2-CAPI-1.11.2 
##  Linking to sp version: 1.4-1 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>world &lt;- ne_countries(scale = &quot;medium&quot;, returnclass = &quot;sf&quot;)
filter(coronavirus, date == max(coronavirus$date), type == &quot;confirmed&quot;, cases &gt; 5000) %&gt;%
  ggplot() +
  geom_sf(data = world) +
  geom_point(aes(x=long, y=lat, size=cases), color=&quot;red&quot;, fill=&quot;red&quot;, alpha=0.5, shape=21) </code></pre>
<p><img src="lesson9-files/unnamed-chunk-33-1.png" /><!-- --></p>
<p><br> <br></p>
</div>
</div>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Come up with an interesting question you want to explore in the Coronavirus dataset with a plot. Try to figure out how to plot it (remember: google is your friend). Be prepared to share your idea with the group during the Zoom call.</p>
<p><br></p>
<p>Examples of questions you could explore:</p>
<ul>
<li><p>We saw earlier that India has had a lower death count per number of confirmed cases than other countries, while Mexico had a higher death count per number of confirmed cases. Has this been a consistent pattern throughout the pandemic?</p></li>
<li><p>For how long has the US been the country with the greatest number of confirmed cases?</p></li>
<li><p>Have the global daily death counts peaked and declined or are they still rising? What about within individual countries?</p></li>
</ul>
<p><br> <br></p>
</div>
<div id="some-example-plots" class="section level2">
<h2>Some example plots:</h2>
<p><br></p>
<div id="trend-in-cumulative-case-count" class="section level4">
<h4>Trend in cumulative case count</h4>
<pre class="r"><code>## linear scale
group_by(coronavirus, date, type) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  group_by(type) %&gt;%
  mutate(cases=cumsum(cases)) %&gt;%
  ggplot() +
  geom_line(aes(x=date, y=cases, color=type))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-34-1.png" /><!-- --></p>
<pre class="r"><code>## log scale
group_by(coronavirus, date, type) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  group_by(type) %&gt;%
  mutate(cases=cumsum(cases)) %&gt;%
  ggplot() +
  geom_line(aes(x=date, y=log(cases), color=type))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-34-2.png" /><!-- --></p>
<p><br></p>
</div>
<div id="trend-in-cumulative-case-count-in-the-10-most-infected-countries" class="section level4">
<h4>Trend in cumulative case count in the 10 most infected countries</h4>
<pre class="r"><code>## linear scale
filter(coronavirus, country %in% top10_countries) %&gt;%
  group_by(country, date, type) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  group_by(country, type) %&gt;%
  mutate(cases=cumsum(cases)) %&gt;%
  ggplot() +
  geom_line(aes(x=date, y=cases/1000, color=type)) +
  ylab(&quot;cumulative count (in thousand)&quot;) +
  facet_wrap(~country, scales = &quot;free_y&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-35-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="trend-in-cumulative-death-rate" class="section level4">
<h4>Trend in cumulative death rate</h4>
<pre class="r"><code>group_by(coronavirus, date, type) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  group_by(type) %&gt;%
  mutate(cases=cumsum(cases)) %&gt;%
  pivot_wider(names_from = type, values_from = cases) %&gt;%
  mutate(death_rate = death/(confirmed+death+recovered)) %&gt;%
  ggplot(aes(x=date, y=death_rate)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-36-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="trend-in-cumulative-death-rate-in-10-most-infected-countries" class="section level4">
<h4>Trend in cumulative death rate in 10 most infected countries</h4>
<pre class="r"><code>filter(coronavirus, country %in% top10_countries) %&gt;%
  group_by(country, date, type) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  group_by(country, type) %&gt;%
  mutate(cases=cumsum(cases)) %&gt;%
  pivot_wider(names_from = type, values_from = cases) %&gt;%
  mutate(death_rate = death/(confirmed+death+recovered)) %&gt;%
  ggplot(aes(x=date, y=death_rate)) +
  geom_line() +
  facet_wrap(~country, scales = &quot;free_y&quot;)</code></pre>
<pre><code>## Warning: Removed 41 rows containing missing values (geom_path).</code></pre>
<p><img src="lesson9-files/unnamed-chunk-37-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="countries-that-had-their-first-reported-coronavirus-case-in-january" class="section level4">
<h4>Countries that had their first reported coronavirus case in January</h4>
<pre class="r"><code>filter(coronavirus, type==&quot;confirmed&quot;, cases&gt;0) %&gt;%
  group_by(country, date) %&gt;%
  summarise() %&gt;%
  group_by(country) %&gt;%
  filter(date==min(date)) %&gt;%
  ungroup() %&gt;%
  arrange(date) %&gt;%
  mutate(rank=row_number(date)) %&gt;%
  filter(months(date)==&quot;January&quot;) %&gt;%
  ggplot(aes(x=date, y=rank)) +
  geom_text(aes(label=country)) +
  xlim(as.Date(c(&quot;2020-01-21&quot;, &quot;2020-02-01&quot;))) +
  theme_minimal()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-38-1.png" /><!-- --></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
